<view class="chat-page">
  <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
  <view class="chat-header" style="padding-top: {{statusBarHeight}}px; height: {{navHeight}}px;">
    <view class="interviewer-info">
      <image class="avatar-sm" src="{{interviewerAvatar}}"></image>
      <text class="interviewer-name">é¢è¯•å®˜</text>
    </view>
    <view class="question-count">{{questionCount}}/{{totalQuestions}}</view>
    <view class="btn-camera" bindtap="toggleCamera">
      <text class="camera-icon">{{cameraEnabled ? 'ğŸ“¹' : 'ğŸ“·'}}</text>
    </view>
    <view class="btn-end" bindtap="confirmEnd">ç»“æŸ</view>
  </view>

  <!-- Camera preview (floating) -->
  <view class="camera-container {{cameraEnabled ? 'camera-show' : 'camera-hide'}}">
    <camera 
      wx:if="{{cameraEnabled}}"
      class="camera-preview" 
      device-position="front" 
      flash="off"
      binderror="onCameraError">
    </camera>
    <view class="camera-tip" wx:if="{{cameraEnabled}}">
      <text>æ‚¨çš„é•œå¤´é¢„è§ˆ</text>
    </view>
  </view>

  <!-- å¯¹è¯åŒºåŸŸ -->
  <scroll-view scroll-y 
               class="chat-area" 
               scroll-into-view="{{scrollToView}}"
               scroll-with-animation="{{true}}"
               style="padding-top: {{navHeight}}px;">
    <view class="messages-container">
      <view wx:for="{{messages}}" wx:key="id" 
            id="msg-{{index}}"
            class="message-wrapper {{item.role === 'ai' ? 'ai-message-wrapper' : 'user-message-wrapper'}}">
        
        <!-- AI message -->
        <view wx:if="{{item.role === 'ai'}}" class="message-row ai-message-row">
          <image class="msg-avatar" src="{{interviewerAvatar}}"></image>
          <view class="msg-bubble ai-bubble">
            <text class="msg-text">{{item.content}}</text>
            <text class="msg-time">{{item.time}}</text>
          </view>
        </view>

        <!-- User message -->
        <view wx:else class="message-row user-message-row">
          <view class="msg-bubble user-bubble">
            <text class="msg-text">{{item.content}}</text>
            <text class="msg-time">{{item.time}}</text>
          </view>
          <image class="msg-avatar" src="{{userAvatar}}"></image>
        </view>
      </view>

      <!-- Bottom spacer -->
      <view class="bottom-spacer"></view>
    </view>
  </scroll-view>

  <!-- è¾“å…¥åŒºåŸŸ -->
  <view class="input-area">
    <textarea class="input-box" 
              placeholder="è¯·è¾“å…¥ä½ çš„å›ç­”..." 
              value="{{inputText}}"
              bindinput="handleInput"
              auto-height
              maxlength="500"
              disabled="{{isThinking}}"></textarea>
    
    <view class="input-actions">
      <view class="btn-voice {{isRecording ? 'recording' : ''}}" 
            bindtouchstart="startRecord"
            bindtouchend="stopRecord">
        <text class="voice-icon">{{isRecording ? 'ğŸ”´' : 'ğŸ¤'}}</text>
      </view>
      <button class="btn-send" 
              bindtap="sendAnswer" 
              disabled="{{!inputText || isThinking}}">
        å‘é€
      </button>
    </view>
  </view>
</view>

