<view class="page-wrapper {{isPageActive ? 'page-active' : ''}}">
  <view class="top-bar">
    <view class="title-lg">ç®€å†ä¸­å¿ƒ</view>
    <view class="coin-pill">
      <text class="coin-symbol">Â¥</text>
      <text class="coin-val">2,380</text>
      <image class="avatar-xs" src="https://api.dicebear.com/7.x/avataaars/svg?seed=Felix"></image>
    </view>
  </view>

  <scroll-view scroll-y class="page-content">
    <view class="container">
      
      <!-- ç®€å†è¯„åˆ†å¡ç‰‡ -->
      <view class="resume-hero-card" wx:if="{{currentResume}}">
        <view class="bg-glow glow-1"></view>
        <view class="bg-glow glow-2"></view>

        <view class="relative z-10">
          <view class="flex-between" style="align-items: flex-start;">
            <view>
              <view class="hero-label">ç®€å†è¯„åˆ†</view>
              <view class="score-row">
                <text class="score-num">{{currentResume.score || 0}}</text>
                <text class="score-total">/100</text>
              </view>
              <view class="rank-badge" wx:if="{{currentResume.score > 0}}">
                <text>ğŸ† è¶…è¿‡ {{currentResume.score}}% æ±‚èŒè€…</text>
              </view>
            </view>

            <view class="dashboard-gauge">
              <view class="gauge-track"></view>
              <view class="gauge-inner">
                <text class="grade-text">{{currentResume.grade || '-'}}</text>
                <text class="grade-sub">{{currentResume.gradeText || 'æœªè¯„åˆ†'}}</text>
              </view>
            </view>
          </view>

          <view class="divider-line"></view>

          <view class="flex-between">
            <view class="update-tip">ä¸Šæ¬¡æ›´æ–°: {{currentResume.lastDiagnosisTime ? 'åˆšåˆš' : 'æœªè¯Šæ–­'}}</view>
            <view class="flex-row">
              <view class="btn-glass mr-2" bindtap="handleAiDiagnose">AI è¯Šæ–­</view>
              <view class="btn-white" bindtap="handlePreviewPdf">é¢„è§ˆ PDF</view>
            </view>
          </view>
        </view>
      </view>

      <!-- ç©ºçŠ¶æ€æç¤º -->
      <view class="empty-state" wx:else>
        <text class="empty-icon">ğŸ“„</text>
        <text class="empty-text">è¿˜æ²¡æœ‰ç®€å†ï¼Œå¿«å»åˆ›å»ºä¸€ä¸ªå§</text>
      </view>

      <view class="flex-between mb-3">
        <text class="title-md">æˆ‘çš„ç®€å†</text>
        <view class="icon-btn-sm">âš™ï¸</view>
      </view>

      <view class="grid-2">
        <!-- åŠ¨æ€æ¸²æŸ“ç®€å†åˆ—è¡¨ -->
        <view 
          wx:for="{{myResumes}}" 
          wx:key="_id"
          wx:if="{{index < 3}}"
          class="card-grid-item" 
          style="animation-delay: {{0.4 + index * 0.1}}s;" 
          bindtap="handleEditResume" 
          data-id="{{item._id}}"
        >
          <view class="flex-between w-full mb-2">
            <view class="icon-box-sm bg-blue-light">ğŸ“„</view>
            <view class="more-dots" catchtap="handleResumeAction" data-id="{{item._id}}">Â·Â·Â·</view>
          </view>
          <view class="item-title mt-2">{{item.title}}</view>
          <view class="item-sub text-xs">{{item.updateTime ? 'æœ€è¿‘æ›´æ–°' : 'å¾…å®Œå–„'}}</view>
        </view>

        <!-- æ–°å»ºç®€å†å¡ç‰‡ -->
        <view class="card-grid-item dashed-border" hover-class="hover-bg" style="animation-delay: 0.5s;" bindtap="handleEditResume">
          <view class="plus-icon">+</view>
          <view class="text-primary font-bold text-sm mt-2">æ–°å»ºç®€å†</view>
        </view>
      </view>

      <!-- ä¼˜åŒ–å»ºè®®åŒº -->
      <view class="mb-3 mt-4">
        <text class="title-md">ä¼˜åŒ–å»ºè®®</text>
      </view>

      <!-- åŠ¨æ€æ¸²æŸ“ä¼˜åŒ–å»ºè®® -->
      <view wx:if="{{suggestions.length > 0}}">
        <view 
          wx:for="{{suggestions}}" 
          wx:key="index"
          class="card-item {{item.type === 'warn' ? 'warn-style' : 'info-style'}}" 
          style="animation-delay: {{0.6 + index * 0.1}}s;" 
          bindtap="handleOptimizationDetail" 
          data-index="{{index}}"
        >
          <view class="flex-row">
            <view class="icon-mini">{{item.icon}}</view>
            <view class="ml-2">
              <view class="font-bold text-sm {{item.type === 'warn' ? 'text-amber-900' : 'text-blue-900'}}">{{item.title}}</view>
              <view class="text-xs {{item.type === 'warn' ? 'text-amber-700' : 'text-blue-700'}} opacity-80">{{item.brief}}</view>
            </view>
          </view>
          <view class="arrow-right {{item.type === 'warn' ? 'text-amber-900' : 'text-blue-900'}}">></view>
        </view>
      </view>

      <!-- ç©ºå»ºè®®æç¤º -->
      <view wx:else class="empty-suggestions">
        <text class="empty-text-sm">å®Œæˆ AI è¯Šæ–­åï¼Œè¿™é‡Œä¼šæ˜¾ç¤ºä¼˜åŒ–å»ºè®®</text>
      </view>

    </view>
  </scroll-view>
</view>
